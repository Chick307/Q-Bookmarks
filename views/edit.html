<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<style>
		html, body { margin: 0; padding: 0; width: 100%; height: 100%; }

		body { overflow-x: hidden; overflow-y: auto; font-size: 12px;
			box-sizing: border-box; -webkit-user-select: none; }

		#toolbar { height: 22px; box-sizing: border-box; }

		#toolbar > button { height: 20px; margin: 0 4px 0 0; padding: 0 1em;
			border: 1px solid #BBB; border-radius: 5px;
			text-shadow: 1px 1px 0 #FFF;
			background: -webkit-linear-gradient(top, #FFF, #DDD);
			box-sizing: border-box; float: left; cursor: pointer;
			color: #404040; font-weight: bold; }

		#toolbar > button:disabled { background: #FFF;
			color: #AAA; cursor: default; }

		#toolbar > button:enabled:active {
			box-shadow: inset 0 0 2px 1px rgba(32, 32, 32, 0.1); }

		#toolbar::after { display: block; content: ""; clear: both; }

		label { display: -webkit-box; -webkit-box-orient: vertical;
			margin: 3px 0; }

		label > span { display: block; margin: 0 0.2em; line-height: 20px; }

		label > input { display: block; padding: 0 3px; border: 1px solid #CCC;
			border-radius: 3px; height: 16pt; background: #FFF;
			box-shadow: inset 1px 1px 2px rgba(0, 0, 0, 0.1);
			font-size: 10pt; }

		label > input:hover { border-color: #AAA; }
		label > input:focus { background: #FFF0D8;
			outline: 1px thick #FFEE88; }

		label[for="remove-box"] { margin-top: 16px;
			-webkit-box-align: center; -webkit-box-orient: horizontal; }

		#remove-btn { opacity: 0; -webkit-transition: opacity 0.2s;
			height: 20px; padding: 0 1em; border: 1px solid #B22;
			border-radius: 3px; text-shadow: -1px -1px 0 #D55;
			background: -webkit-linear-gradient(top, #F88, #D55);
			box-sizing: border-box; cursor: pointer; color: #FFF;
			font-weight: bold; }
	</style>
</head>
<body>
	<div id="toolbar">
		<button id="cancel-btn">Cancel</button>
		<button id="ok-btn" disabled>OK</button>
	</div>
	<label for="title-box">
		<span>Title</span>
		<input type="text" id="title-box">
	</label>
	<label for="url-box">
		<span>URL</span>
		<input type="text" id="url-box">
	</label>
	<label for="remove-box">
		<input type="checkbox" id="remove-box">
		<span>Remove this item</span>
	</label>
	<button id="remove-btn">Remove</button>
	<script>
		var allBookmarks = top.backgroundPage.allBookmarks,
			otherBookmarks = top.backgroundPage.otherBookmarks;
		var item = allBookmarks[location.hash.substr(1)];

		var okBtn = document.querySelector('#ok-btn'),
			cancelBtn = document.querySelector('#cancel-btn'),
			titleBox = document.querySelector('#title-box'),
			urlBox = document.querySelector('#url-box'),
			removeBox = document.querySelector('#remove-box'),
			removeBtn = document.querySelector('#remove-btn');

		titleBox.value = item.title;
		if(item.hasOwnProperty('url')){
			urlBox.value = item.url;
		}else{
			urlBox.parentNode.style.display = 'none';
		}

		titleBox.addEventListener('input', function(){
			if(okBtn.hasAttribute('disabled'))
				okBtn.removeAttribute('disabled');
		}, false);

		urlBox.addEventListener('input', function(){
			if(okBtn.hasAttribute('disabled'))
				okBtn.removeAttribute('disabled');
		}, false);

		okBtn.addEventListener('click', function(){
			top.getBookmarkEdit(item.id).close();
			if(titleBox.value != item.title)
				item.title = titleBox.value;
			if(urlBox.value != item.url)
				item.url = urlBox.value;
			top.getBookmarkView(item.parent.id).reload();
			removeBox.checked = false;
			removeBtn.style.opacity = '0';
			okBtn.setAttribute('disabled', 'disabled');
		}, false);

		cancelBtn.addEventListener('click', function(){
			top.getBookmarkEdit(item.id).close();
			titleBox.value = item.title;
			urlBox.value = item.url;
			removeBox.checked = false;
			removeBtn.style.opacity = '0';
			okBtn.setAttribute('disabled', 'disabled');
		}, false);

		removeBox.addEventListener('change', function(){
			removeBtn.style.opacity = this.checked? '1': '0';
		}, false);

		removeBtn.addEventListener('click', function(){
			top.removeBookmark(item.id);
			top.getBookmarkEdit(item.id).close();
			item.remove();
		});
	</script>
</body>
</html>
