<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="/styles/option.css">
	<style>
		span {
			display: inline-block;
			margin: 0 0.5em;
			padding: 0 0.5em;
			border-radius: 3px;
			background: linear-gradient(top, #0C0, #0A0);
			background: -webkit-linear-gradient(top, #2C2, #2A2);
			color: #FFF;
			text-shadow: -1px -1px 0 #2A2;
			opacity: 0;
			transition: opacity 0.1s;
			-webkit-transition: opacity 0.1s;
		}

		span.saved {
			opacity: 1;
		}
	</style>
</head>
<body>
	<h1>Behavior</h1>
	<ul>
		<li><label for="open-in-box">Open bookmark in</label>
		<select id="open-in-box">
			<option value="1">current tab</option>
			<option value="2">new tab</option>
		</select>
		<span id="open-in-msg">saved</span>
	</ul>

	<h1>Appearance</h1>
	<ul>
		<li><label for="font-family-box">font family</label>
		<select id="font-family-box">
			<option value="serif">Serif</option>
			<option value="sans-serif">Sans Serif</option>
		</select>
		<span id="font-family-msg">saved</span>
	</ul>

	<script type="text/javascript">
		var backgroundPage = chrome.extension.getBackgroundPage();
		var pref = backgroundPage.pref;


		var openInBox = Q('#open-in-box');
		openInBox.value = pref.get('open-in');
		openInBox.addEventListener('change', function(){
			pref.set('open-in', openInBox.value);

			var msg = Q('#open-in-msg');
			onSaved(msg);
		}, false);


		var fontFamilyBox = Q('#font-family-box');
		fontFamilyBox.value = pref.get('font-family');
		fontFamilyBox.addEventListener('change', function(){
			pref.set('font-family', fontFamilyBox.value);

			var msg = Q('#font-family-msg');
			onSaved(msg);
		}, false);


		var timeouts = {};
		function onSaved(msg){
			if(msg.id in timeouts){
				clearTimeout(timeouts[msg.id]);
				msg.classList.remove('saved');
				timeouts[msg.id] = setTimeout(function(){
					setSaved();
				}, 100);
			}else{
				setSaved();
			}

			function setSaved(){
				msg.classList.add('saved');
				timeouts[msg.id] = setTimeout(function(){
					msg.classList.remove('saved');
					delete timeouts[msg.id];
				}, 1600);
			}
		}


		window.addEventListener('pref-changed', function(event){
			var key = event.key, value = event.value;

			if(key === 'open-in' && openInBox.value !== value){
				openInBox.value = event.value;
			}else if(key === 'font-family' && fontFamilyBox.value !== value){
				fontFamilyBox.value = value;
			}
		});

		function Q(selector){
			return document.querySelector(selector);
		}
	</script>
</body>
</html>

